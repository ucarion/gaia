#!/bin/bash

bold=$(tput bold)
normal=$(tput sgr0)

log() {
    echo "${bold}${1}${normal}"
}

blue_marble_prefix="assets/nasa_blue_marble/world.topo.bathy.200412.3x21600x21600"

mkdir -p assets/generated/tiles

if [ ! -f assets/generated/world_elevation.bin ]; then
    log "Generating complete world elevation for later tiles ..."

    convert -monitor -depth 16 \
        \( -monitor -size 10800x4800 \
            gray:assets/noaa_globe/a10g \
            gray:assets/noaa_globe/b10g \
            gray:assets/noaa_globe/c10g \
            gray:assets/noaa_globe/d10g \
            -evaluate addmodulus 500 -resize 1024 +append \
        \) \
        \( -monitor -size 10800x6000 \
            gray:assets/noaa_globe/e10g \
            gray:assets/noaa_globe/f10g \
            gray:assets/noaa_globe/g10g \
            gray:assets/noaa_globe/h10g \
            -evaluate addmodulus 500 -resize 1024 +append \
        \) \
        \( -monitor -size 10800x6000 \
            gray:assets/noaa_globe/i10g \
            gray:assets/noaa_globe/j10g \
            gray:assets/noaa_globe/k10g \
            gray:assets/noaa_globe/l10g \
            -evaluate addmodulus 500 -resize 1024 +append \
        \) \
        \( -monitor -size 10800x4800 \
            gray:assets/noaa_globe/m10g \
            gray:assets/noaa_globe/n10g \
            gray:assets/noaa_globe/o10g \
            gray:assets/noaa_globe/p10g \
            -evaluate addmodulus 500 -resize 1024 +append \
        \) \
        -append \
        -resize 4096x2048 \
        gray:assets/generated/world_elevation.bin
fi

if [ ! -d assets/generated/tiles/west_hemisphere ]; then
    mkdir assets/generated/tiles/west_hemisphere

    log "Generating textures for west_hemisphere"
    convert \
        \( \
            -monitor \
            "${blue_marble_prefix}.A1.jpg" -resize 5400 \
            "${blue_marble_prefix}.B1.jpg" -resize 5400 \
            +append \
        \) \
        \( \
            -monitor \
            "${blue_marble_prefix}.A2.jpg" -resize 5400 \
            "${blue_marble_prefix}.B2.jpg" -resize 5400 \
            +append \
        \) \
        -append \
        assets/generated/tiles/west_hemisphere/0.jpg

    convert -monitor assets/generated/tiles/west_hemisphere/0.jpg \
        \( +clone -resize 50% -write assets/generated/tiles/west_hemisphere/1.jpg +delete \) \
        \( +clone -resize 25% -write assets/generated/tiles/west_hemisphere/2.jpg +delete \) \
        -resize 12.5% assets/generated/tiles/west_hemisphere/3.jpg

    log "Generating elevation for west_hemisphere"
    convert -monitor \
        -depth 16 -size 4096x2048 gray:assets/generated/world_elevation.bin \
        -crop 2049x2048+0+0 \
        gray:assets/generated/tiles/west_hemisphere/elevation.bin
fi

if [ ! -d assets/generated/tiles/east_hemisphere ]; then
    mkdir assets/generated/tiles/east_hemisphere

    log "Generating textures for east_hemisphere"
    convert \
        \( \
            -monitor \
            "${blue_marble_prefix}.C1.jpg" -resize 5400 \
            "${blue_marble_prefix}.D1.jpg" -resize 5400 \
            +append \
        \) \
        \( \
            -monitor \
            "${blue_marble_prefix}.C2.jpg" -resize 5400 \
            "${blue_marble_prefix}.D2.jpg" -resize 5400 \
            +append \
        \) \
        -append \
        assets/generated/tiles/east_hemisphere/0.jpg

    convert -monitor assets/generated/tiles/east_hemisphere/0.jpg \
        \( +clone -resize 50% -write assets/generated/tiles/east_hemisphere/1.jpg +delete \) \
        \( +clone -resize 25% -write assets/generated/tiles/east_hemisphere/2.jpg +delete \) \
        -resize 12.5% assets/generated/tiles/east_hemisphere/3.jpg

    log "Generating elevation for east_hemisphere"
    convert -monitor \
        -depth 16 -size 4096x2048 \
        \( gray:assets/generated/world_elevation.bin -crop 2048x2048+2048+0 \) \
        \( gray:assets/generated/world_elevation.bin -crop 1x2048+0+0 \) \
        +append \
        gray:assets/generated/tiles/east_hemisphere/elevation.bin
fi
